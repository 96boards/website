---
title: "96boards: Autoware everywhere | Hikey970"
author: Servando German Serrano
date: 2019-11-21 01:00:00+00:00
image:
    featured: true
    path: /assets/images/blog/awf_white.png
    name: awf_white.png
categories: blog
series: "96boards: Autoware everywhere"
tags: 64-bit, 96Boards, aarch64, ARM, ARMv8, Consumer Edition, Dragonboard-845c, Linaro, Linux, arm64, real time, ROS2
---

# Introduction
This is the first entry of our "96boards: Autoware everywhere" blog series. With this blog series we will show how to use 96boards hardware to run different components of the Autoware software stack for autonomous vehicles.

### Autoware.AI
[Autoware.AI](https://www.autoware.ai/) is the world's first "All-in-One" open-source software for autonomous driving technology. It is based on ROS 1 and available under Apache 2.0 license. It contains the following modules:
- Localization is achieved by 3D maps and SLAM algorithms in combination with GNSS and IMU sensors.
- Detection uses cameras and LiDARs with sensor fusion algorithms and deep neural networks.
- Prediction and Planning are based on probabilistic robotics and rule-based systems, partly using deep neural networks as well.
- The output of Autoware to the vehicle is a twist of velocity and angular velocity. This is a part of Control, though the major part of Control stack commonly reside in the by-wire controller of the vehicle.

### Autoware.Auto
[Autoware.Auto](https://www.autoware.auto/) is a project supported by the [Autoware Foundation](https://www.autoware.org/). It is a clean slate rewrite of Autoware. Autoware.Auto applies best-in-class software engineering practices which include pull request reviews, pull request builds, comprehensive documentation, 100% code coverage, a coding style guide, and a defined development and release process, all managed by an open source community manager.

It also has crisply defined interfaces for different modules including messages and APIs and a software architecture designed for determinism such that will be possible to reproduce behaviors live and on development machines.


To kick things off we will first start outlining how to get [Autoware.AI's rosbag demo](https://gitlab.com/autowarefoundation/autoware.ai/autoware/wikis/ROSBAG-Demo) running on the headless Hikey970 and use a different machine for visualization.

The post is organized as follows:
- [Requirements](#requirements)
- [Installing Docker](#installing-docker)
- [ROS2 and the pendulum demo](#ros2-and-the-pendulum-demo)
  - [Rttest library modifications](#rttest-library-modifications)

***
## Requirements
For the following steps you will need your Hikey970 to be accesible via SSH and for an easier setup have Docker installed on it. So, to get the board ready you can follow the steps [here](https://www.96boards.org/blog/hikey970-rt/) if you plan to also develop real time applications using ROS/ROS2 or just use the [Bionic Builder Tool](https://discuss.96boards.org/t/tool-bionic-builder-automated-kernel-ubuntu-builder-for-hikey970/7879) to get Ubuntu 18.04 working.

In addition, to install Docker you just need to follow the official steps to install docker on arm64 target for [Ubuntu](https://docs.docker.com/install/linux/docker-ce/ubuntu/). Though it is also possible to [install ROS Melodic](http://wiki.ros.org/melodic/Installation/Ubuntu) natively on the board running Ubuntu 18.04.

## Getting Autoware.AI

### Docker
For convenience and quick evaluation purposes a Docker image with a precompiled version of Autoware.auto can be found in the [96Boards/autoware Dockerhub repo](https://hub.docker.com/r/96boards/autoware/tags).





### Cross-compile

We can follow the [ROS2 cross-compile tutorial](https://index.ros.org/doc/ros2/Tutorials/Cross-compilation/)

```
$ mkdir aw_cc
$ cd aw_cc
$ git clone --recursive https://gitlab.com/autowarefoundation/autoware.auto/AutowareAuto.git
$ git clone https://github.com/ros-tooling/cross_compile.git
$ mkdir qemu-user-static
$ cp /usr/bin/qemu-*-static qemu-user-static
$ wget Dockerfile
$ docker build -t 96boards/ros:mel_dash -f Dockerfile.ros1_ros2 .
$ docker run --name arm_sysroot 96boards/ros:mel_dash
```
$ export TARGET_ARCH=aarch64
$ export TARGET_TRIPLE=aarch64-linux-gnu
$ export CC=/usr/bin/$TARGET_TRIPLE-gcc
$ export CXX=/usr/bin/$TARGET_TRIPLE-g++
$ export CROSS_COMPILE=/usr/bin/$TARGET_TRIPLE-
$ export SYSROOT=~/aw_cc/sysroot_docker
$ export ROS2_INSTALL_PATH=~/aw_cc/sysroot_docker/opt/ros/dashing/:~/aw_cc/AutowareAuto/install/
$ export ROS2_INSTALL_PATH=~/aw_cc/AutowareAuto/install/:~/aw_cc/sysroot_docker/opt/ros/dashing/
$ export CMAKE_PREFIX_PATH=~/aw_cc/AutowareAuto/install/
$ export PYTHON_SOABI=cpython-36m-$TARGET_TRIPLE
$ wget https://raw.githubusercontent.com/ros-tooling/cross_compile/0.0.1/cmake-toolchains/generic_linux.cmake
$ cd AutowareAuto/
$ colcon build --merge-install \
    --cmake-force-configure \
    --cmake-args \
    -DCMAKE_VERBOSE_MAKEFILE:BOOL=ON \
    -DCMAKE_TOOLCHAIN_FILE="$(pwd)/../generic_linux.cmake"





docker run -it --rm --privileged --net=host -u linaro 96boards/ros:ros1_bridge /bin/bash -c "source /opt/ros/melodic/setup.bash && source /opt/ros/dashing/local_setup.bash && ros2 run ros1_bridge dynamic_bridge --bridge-all-topics"

docker run -it --rm --privileged --net=host -u linaro sgerman/arm64v8:mel_dash /bin/bash -c "source /opt/ros/melodic/setup.bash && source /opt/ros/dashing/local_setup.bash && ros2 run ros1_bridge dynamic_bridge --bridge-all-topics"

***

# Conclusion

Upon completion of the steps above we now have a working board with a real time enabled kernel.

Next time, we'll reproduce the ROS2 and pendulum demo test that was conducted on the Hikey970 in our [previous post](https://www.96boards.org/blog/hikey970-ros2/), so keep an eye to this space.
