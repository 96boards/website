---
title: "96boards: Autoware everywhere | Hikey970"
author: Servando German Serrano
date: 2019-11-21 01:00:00+00:00
image:
    featured: true
    path: /assets/images/blog/awf_white.png
    name: awf_white.png
categories: blog
series: "96boards: Autoware everywhere"
tags: 64-bit, 96Boards, aarch64, ARM, ARMv8, Consumer Edition, Dragonboard-845c, Linaro, Linux, arm64, real time, ROS2
---

# Introduction
This is the first entry of our "96boards: Autoware everywhere" blog series. With this blog series we will show how to use 96boards hardware to run different components of the Autoware software stack for autonomous vehicles.

### Autoware.AI
[Autoware.AI](https://www.autoware.ai/) is the world's first "All-in-One" open-source software for autonomous driving technology. It is based on ROS 1 and available under Apache 2.0 license. It contains the following modules:
- Localization is achieved by 3D maps and SLAM algorithms in combination with GNSS and IMU sensors.
- Detection uses cameras and LiDARs with sensor fusion algorithms and deep neural networks.
- Prediction and Planning are based on probabilistic robotics and rule-based systems, partly using deep neural networks as well.
- The output of Autoware to the vehicle is a twist of velocity and angular velocity. This is a part of Control, though the major part of Control stack commonly reside in the by-wire controller of the vehicle.

### Autoware.Auto
[Autoware.Auto](https://www.autoware.auto/) is a project supported by the [Autoware Foundation](https://www.autoware.org/). It is a clean slate rewrite of Autoware. Autoware.Auto applies best-in-class software engineering practices which include pull request reviews, pull request builds, comprehensive documentation, 100% code coverage, a coding style guide, and a defined development and release process, all managed by an open source community manager.

It also has crisply defined interfaces for different modules including messages and APIs and a software architecture designed for determinism such that will be possible to reproduce behaviors live and on development machines.


To kick things off we will first start outlining how to get [Autoware.AI's rosbag demo](https://gitlab.com/autowarefoundation/autoware.ai/autoware/wikis/ROSBAG-Demo) running on the headless Hikey970 and use a different machine for visualization.

The post is organized as follows:
- [Requirements](#requirements)
- [Getting Autoware.AI](#getting-autoware.ai)
  - [From source](#from-source)
  - [Docker](#docker)
- [Running the rosbag demo](#running-the-rosbag-demo)


***
## Requirements
For the following steps you will need your Hikey970 to be accesible via SSH and for an easier setup have Docker installed on it. So, to get the board ready you can follow the steps [here](https://www.96boards.org/blog/hikey970-rt/) if you plan to also develop real time applications using ROS/ROS2 or just use the [Bionic Builder Tool](https://discuss.96boards.org/t/tool-bionic-builder-automated-kernel-ubuntu-builder-for-hikey970/7879) to get Ubuntu 18.04 working.

In addition, to install Docker you just need to follow the official steps to install docker on arm64 target for [Ubuntu](https://docs.docker.com/install/linux/docker-ce/ubuntu/). Though it is also possible to [install ROS Melodic](http://wiki.ros.org/melodic/Installation/Ubuntu) natively on the board running Ubuntu 18.04.

## Getting Autoware.AI

### From source
If you have opted for installing ROS natively on the board you can follow the [Autoware.AI source build instructions](https://gitlab.com/autowarefoundation/autoware.ai/autoware/wikis/Source-Build) to get it installed natively.

### Docker
If you have decided to go down the Docker route there are pre-compiled Autoware images in the [autoware/arm64v8 Dockerhub repository](https://hub.docker.com/r/autoware/arm64v8/tags). To pull and run one we just need to SSH to the board and follow the next steps:
- Create a `shared_dir` folder that will be mounted as a volume inside the docker container:
```
$ mkdir ~/shared_dir
```
we will use this folder to store the rosbag demo data.
- Clone the Autoware.AI's `docker` repository to make use of the convenience scripts:
```
$ git clone https://gitlab.com/autowarefoundation/autoware.ai/docker.git
$ cd docker/generic
$ ./run.sh -c off -i autoware/arm64v8 -t 1.12.0
```
Which will pull and run `1.12.0-melodic` Autoware image. Once inside the container if we do `ls` we will see:
```
$ ls
Autoware  shared_dir
```

## Running the rosbag demo
If you have chosen to just install Ubuntu 18.04 using the Bionic Buil Tool and use a monitor with the board you can follow the default [rosbag demo steps](https://gitlab.com/autowarefoundation/autoware.ai/autoware/wikis/ROSBAG-Demo) since you have access to the GUI. For the headless approach please keep reading.

To be able to run the demo we need to download the [demo data](https://gitlab.com/autowarefoundation/autoware.ai/autoware/wikis/ROSBAG-Demo#demo-data) and extract it inside the `shared_dir` folder. We will then have the following:
```
$ ls shared_dir
data  sample_moriyama_150324.bag
```
To run headless we will also need to setup some Autoware parameters. We can `wget` the setup file into the `shared_dir`:
```
$ cd ~/shared_dir
$ wget http://people.linaro.org/~servando.german.serrano/autoware/headless_setup.yaml
```

To run the each component of the demo independently we will need **7** terminals where we have ssh'ed into the Hikey970.

Now in Terminal 1 we run our container and, within it, make an `.autoware` folder and copy the `data` folder over:
```
$ ./run.sh -c off -i autoware/arm64v8 -t 1.12.0
$ mkdir ~/.autoware
$ cp -r ~/shared_dir/data ~/.autoware/data
```
We also need to set some environment variables following the [ROS in Multiple Machines tutorial](http://wiki.ros.org/ROS/Tutorials/MultipleMachines) to be able to run the visualization in a laptop. To avoid repeating the same setup steps in each of the terminals we can do:
```
$ echo "export ROS_MASTER_URI=http://BOARD_IP_ADDRESS:11311" >> ~/.bashrc
$ source ~/.bashrc
```
inside the container in Terminal 1, where `BOARD_IP_ADDRESS` is the current IP address of your Hikey970.

In one of the other terminals we check the name of the created container, which will be something like:
```
$ docker ps
CONTAINER ID        IMAGE                             COMMAND                CREATED             STATUS              PORTS               NAMES
3dc4cbcd8519        autoware/arm64v8:1.12.0-melodic   "/tmp/entrypoint.sh"   39 seconds ago      Up 39 seconds                           goofy_lamarr
```
We can now access the same container on each of the terminals so that we do not need set the same environment variables on each individual container. On each terminal we do:
```
$ docker exec -it -u autoware goofy_lamarr /bin/bash
$ cd ~
$ source Autoware/install/setup.bash
```
1. Hikey970 -> Terminal 1
```
$ roscore &
$ rosparam load ~/shared_dir/headless_setup.yaml &
$ rosbag play --pause -s 140 ~/shared_dir/sample_moriyama_150324.bag
```

2. Laptop -> Terminal
```
$ wget https://gitlab.com/autowarefoundation/autoware.ai/documentation/raw/master/autoware_quickstart_examples/launch/rosbag_demo/default.rviz
$ export ROS_MASTER_URI=http://BOARD_IP_ADDRESS:11311
$ rosrun rviz rviz
```

3. Hikey970 -> Terminal 2
```
$ roslaunch autoware_quickstart_examples my_map.launch
```

4. Hikey970 -> Terminal 3
```
$ roslaunch autoware_quickstart_examples my_sensing.launch
```

5. Hikey970 -> Terminal 4
```
$ roslaunch autoware_quickstart_examples my_localization.launch
```

6. Hikey970 -> Terminal 5
```
$ roslaunch autoware_quickstart_examples my_detection.launch
```

7. Hikey970 -> Terminal 6
```
$ roslaunch autoware_quickstart_examples my_mission_planning.launch
```

8. Hikey970 -> Terminal 7
```
$ roslaunch autoware_quickstart_examples my_motion_planning.launch
```





***

# Conclusion

Upon completion of the steps above we now have a working board with a real time enabled kernel.

Next time, we'll reproduce the ROS2 and pendulum demo test that was conducted on the Hikey970 in our [previous post](https://www.96boards.org/blog/hikey970-ros2/), so keep an eye to this space.
